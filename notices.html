<!doctype html>
<html lang="ko" data-theme="auto">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Looma — Notices</title>

  <link href="https://fonts.googleapis.com/css2?family=Lexend+Peta:wght@800&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet"/>

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0A0A0A">
  <script>
    (function(){
      try{
        var root = document.documentElement;
        var theme = localStorage.getItem('looma:theme');
        if(theme !== 'light' && theme !== 'dark'){ theme = 'auto'; }
        if(theme === 'auto'){ root.removeAttribute('data-theme'); }
        else{ root.setAttribute('data-theme', theme); }
        root.dataset.themePreference = theme;
      }catch(err){ /* ignore */ }
    })();
  </script>
  <script src="theme.js"></script>

  <style>
    :root{
      --bg:#0A0A0A; --surface:#111213; --elev:#151618; --line:#1E2023;
      --text:#EDEFF2; --muted:#9AA3AE; --brand:#0EA5E9;
      --radius:14px; --shadow:0 8px 18px rgba(0,0,0,.18); --speed:.18s;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#F7F8FA; --surface:#FFFFFF; --elev:#F3F5F8; --line:#E6EAF0;
        --text:#0B1220; --muted:#596174; --brand:#0077FF;
        --shadow:0 10px 22px rgba(10,16,30,.08);
      }
    }
    *{ box-sizing:border-box }
    html, body{ height:100% }
    body{
      margin:0; background:var(--bg); color:var(--text);
      font:14px/1.6 "Inter", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    a{ color:inherit; text-decoration:none }
    button{ font:inherit; border:0; background:none; color:inherit; cursor:pointer }

    .page{ min-height:100dvh; display:flex; flex-direction:column }
    .topbar{
      position:sticky; top:0; z-index:20;
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 16px; border-bottom:1px solid var(--line); background:var(--surface);
      backdrop-filter:blur(12px);
    }
    .topbar .brand{ font-family:"Lexend Peta"; font-weight:800; letter-spacing:.4px }
    .topbar .left{ display:flex; align-items:center; gap:10px }
    .circle-btn{
      width:34px; height:34px; border-radius:50%; border:1px solid var(--line);
      display:grid; place-items:center; background:var(--elev);
      transition: background var(--speed), border-color var(--speed), transform var(--speed);
    }
    .circle-btn:hover{ background:var(--brand); border-color:transparent; color:#fff; transform:translateY(-1px); }

    main{
      flex:1; padding:20px 16px 40px; max-width:680px; margin:0 auto; width:100%;
      display:grid; gap:16px;
    }

    .notice-card{
      border:1px solid var(--line); border-radius:16px; background:var(--surface);
      padding:18px; display:grid; gap:10px; box-shadow:var(--shadow);
      transition: transform var(--speed), border-color var(--speed);
    }
    .notice-card.highlight{ border-color:var(--brand); box-shadow:0 0 0 2px rgba(14,165,233,.28); }
    .notice-card:hover{ transform:translateY(-2px); }
    .notice-head{ display:flex; align-items:center; gap:8px; justify-content:space-between }
    .notice-title{ font-size:18px; font-weight:800; }
    .notice-meta{ color:var(--muted); font-size:12px }
    .notice-body{ white-space:pre-wrap; line-height:1.55 }
    .badge{
      display:inline-flex; align-items:center; gap:4px; padding:4px 8px;
      border-radius:999px; background:rgba(14,165,233,.12); color:var(--brand);
      font-size:12px; font-weight:700;
    }
    .empty{
      text-align:center; padding:32px 0; color:var(--muted); border:1px dashed var(--line);
      border-radius:12px;
    }
    .hidden{ display:none !important }

    @media (max-width:640px){
      main{ padding:16px 12px 32px; }
      .notice-card{ padding:16px; border-radius:14px; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="topbar">
      <div class="left">
        <a href="home.html" data-nav class="circle-btn" aria-label="뒤로"><i class="ri-arrow-left-line"></i></a>
        <div class="brand">공지사항</div>
      </div>
      <a href="superadmin.html" data-nav class="circle-btn" aria-label="관리자"><i class="ri-shield-star-line"></i></a>
    </header>

    <main>
      <div id="noticeList"></div>
      <div id="emptyState" class="empty hidden">등록된 공지사항이 없습니다.</div>
    </main>
  </div>

  <script>
    (function(){
      const $ = (s)=> document.querySelector(s);
      const listEl = $('#noticeList');
      const emptyEl = $('#emptyState');

      document.querySelectorAll('a[data-nav]').forEach((link)=>{
        const href = link.getAttribute('href') || '';
        link.addEventListener('click',(ev)=>{
          if(!href || href.startsWith('#') || href.startsWith('http')) return;
          ev.preventDefault();
          if(document.startViewTransition){
            document.startViewTransition(()=> location.href = href);
          }else{
            document.body.style.opacity = '0';
            setTimeout(()=> location.href = href, 140);
          }
        });
      });

      function renderNoticeCard(item, highlightId){
        const card = document.createElement('article');
        card.className = 'notice-card';
        if(item.id === highlightId) card.classList.add('highlight');
        card.innerHTML = `
          <div class="notice-head">
            <div>
              <div class="notice-title">${item.title || '제목 없음'}</div>
              <div class="notice-meta">${new Date(item.createdAt).toLocaleString()}${item.updatedAt && item.updatedAt!==item.createdAt ? ' · 업데이트됨' : ''}</div>
            </div>
            ${item.pinned ? '<span class="badge"><i class="ri-pushpin-fill"></i>상단 고정</span>' : ''}
          </div>
          <div class="notice-body">${item.body || ''}</div>
        `;
        return card;
      }

      async function loadNotices(){
        let highlightId = null;
        try{
          const params = new URLSearchParams(location.search);
          highlightId = params.get('id');
        }catch(err){ /* ignore */ }
        try{
          const res = await fetch('/api/announcements', { credentials:'include' });
          if(!res.ok) throw new Error(await res.text());
          const data = await res.json();
          const items = Array.isArray(data.items) ? data.items : [];
          listEl.innerHTML = '';
          if(!items.length){
            emptyEl.classList.remove('hidden');
            return;
          }
          emptyEl.classList.add('hidden');
          items.forEach((item)=>{
            const card = renderNoticeCard(item, highlightId);
            listEl.appendChild(card);
            if(item.id === highlightId){
              setTimeout(()=> card.scrollIntoView({ behavior:'smooth', block:'start' }), 80);
            }
          });
        }catch(err){
          listEl.innerHTML = '';
          emptyEl.textContent = '공지사항을 불러오지 못했습니다. 잠시 후 다시 시도해 주세요.';
          emptyEl.classList.remove('hidden');
        }
      }

      loadNotices();
    })();
  </script>
</body>
</html>
